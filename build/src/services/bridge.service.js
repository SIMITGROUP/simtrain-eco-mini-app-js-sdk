/**
 * This file was automatically generated by simpleapp generator. Every
 * MODIFICATION OVERRIDE BY GENERATEOR
 * last change 2025-06-18
 * Author: --
 */
import { MINI_APP_BRIDGE_MESSAGES } from "../constants/common.constant";
export class MiniAppBridgeService {
    pendingRequests = {};
    constructor() {
        if (typeof window !== "undefined") {
            window.addEventListener("message", (event) => {
                const message = event.data;
                if (message.type === MINI_APP_BRIDGE_MESSAGES.API_RESPONSE &&
                    message.requestId) {
                    const handler = this.pendingRequests[message.requestId];
                    if (!handler)
                        return;
                    if (message.success) {
                        handler.resolve(message.data);
                    }
                    else {
                        handler.reject(message.error);
                    }
                    delete this.pendingRequests[message.requestId];
                }
            });
        }
    }
    async callApi(resource, action, params = {}) {
        const requestId = crypto.randomUUID();
        // TODO: Type
        const requestMessage = {
            type: MINI_APP_BRIDGE_MESSAGES.API,
            requestId,
            params: {
                resource: { name: resource, id: params.id },
                action,
                query: params.query,
                body: params.body,
                queryParams: params.queryParams,
            },
        };
        const promise = new Promise((resolve, reject) => {
            this.pendingRequests[requestId] = { resolve, reject };
        });
        window.parent.postMessage(requestMessage, "*");
        return promise;
    }
    openOnScreenResourceForm(resource, params = {}) {
        const message = {
            type: MINI_APP_BRIDGE_MESSAGES.OPEN_ON_SCREEN_RESOURCE_FORM,
            params: {
                resource: { name: resource, id: params.id },
                data: params.data,
            },
        };
        window.parent.postMessage(message, "*");
    }
}
